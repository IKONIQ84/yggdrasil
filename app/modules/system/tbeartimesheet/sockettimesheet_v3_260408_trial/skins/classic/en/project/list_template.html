<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>{PAGE_TITLE}</title>
{__CSS_GLOBAL__}
<style type="text/css">@import url('{SKINROOT}/javascript/{BROWSER}/calendar/calendar-blue.css');</style>
<script type="text/javascript" src="{SKINROOT}/javascript/{BROWSER}/calendar/calendar.js"></script>
<script type="text/javascript" src="{SKINROOT}/javascript/{BROWSER}/calendar/calendar-en.js"></script>
<script type="text/javascript" src="{SKINROOT}/javascript/{BROWSER}/calendar/calendar-setup.js"></script>

<script type="text/javascript" src="{SKINROOT}/javascript/{BROWSER}/listing.js"></script>
<script type="text/javascript" src="{SKINROOT}/javascript/{BROWSER}/fieldSelection.js"></script>
<script type="text/javascript" src="{SKINROOT}/javascript/{BROWSER}/helpScript.js"></script>
<script type="text/javascript" src="{SKINROOT}/javascript/{BROWSER}/tabScript.js"></script>
<script type="text/javascript" src="{SKINROOT}/javascript/{BROWSER}/searchScript.js"></script>
<script type="text/javascript" src="{SKINROOT}/javascript/{BROWSER}/functions.js"></script>
<script type="text/javascript" src="{SKINROOT}/javascript/{BROWSER}/ajaxScript.js"></script>
<script type="text/javascript" src="{SKINROOT}/javascript/{BROWSER}/treeview_prj_list.js"></script>

<script>
// AJAX CORNER

function ajaxParser(){
	if(request.readyState == 1){
		document.getElementById('title').innerHTML = oriMessage + '&nbsp;&nbsp;&nbsp;<font id="executing"><img align="top" src="{SKINROOT}/images/executing.gif">Executing...</font>';
	}
	if(request.readyState == 4){ 
		var result = request.responseText.split('regexAJAX');
		if(document.getElementById('action').value == 'sort_table') {
			document.getElementById('listingOutputAJAX').innerHTML = result[0];
		}
		if(document.getElementById('action').value == 'change_status' || 
		document.getElementById('action').value == 'make_query' || 
		document.getElementById('action').value == 'searchDB' ||
		document.getElementById('action').value == 'reset_search') {
			document.getElementById('listingOutputAJAX').innerHTML = result[0];
			document.getElementById('listingOutputPagesAJAX').innerHTML = result[4];
			document.getElementById('listingButtonsAJAX').innerHTML = result[5];			
		}
		if(document.getElementById('action').value == 'reset2default' || document.getElementById('action').value == 'field_update') {
			document.getElementById('listingOutputAJAX').innerHTML = result[0];
			document.getElementById('selectSelected').innerHTML = result[2];
			document.getElementById('selectAvailable').innerHTML = result[3];
		}

		if(document.getElementById('action').value == 'delete_quicklinks' || document.getElementById('action').value == 'add_quicklinks') {
			document.getElementById(document.getElementById('messageID').value).innerHTML = result[0];
			document.getElementById('quicklinks_button').innerHTML = result[1];
			document.getElementById('menuAJAX').innerHTML = result[2];
		}
		if(document.getElementById('action').value == 'template') {
			document.getElementById(document.getElementById('messageID').value).innerHTML = result[0];
			document.getElementById('listingMessageOutputAJAX').style.display = '';
			document.getElementById('listingNoOutput').style.display = 'none';
			submitMultiUnSelect(document.getElementById('source'),document.getElementById('target'));
			document.getElementById('template_editor').style.display = '';
			expandcontent('sc3', document.getElementById('template_editor'));
			//Fill Contents With Current Template Selection
			document.getElementById('name').value = result[1];
			document.getElementById('code').value = result[2];
			document.getElementById('description').value = result[3];			
			document.getElementById('start_date').value = result[4];			
			document.getElementById('end_date').value = result[5];			
			document.getElementById('pm').innerHTML = result[6];
			document.getElementById('secondary_pm').innerHTML = result[7];						
			document.getElementById('client').innerHTML = result[8];						
			document.getElementById('project_phase').innerHTML = result[9];						
			document.getElementById('project_status').innerHTML = result[10];						
			document.getElementById('project_rate').innerHTML = result[11];						
			document.getElementById('project_leader_approve').innerHTML = result[12];						
			document.getElementById('project_cost').innerHTML = result[13];						
		}
		if(document.getElementById('action').value == 'gencode') {
			document.getElementById(document.getElementById('messageID').value).innerHTML = result[0];
			document.getElementById('code').value = result[1];
		}
		if(document.getElementById('action').value == 'generate_project') {
			document.getElementById(document.getElementById('messageID').value).innerHTML = result[1];
			if(parseInt(result[0])){ //Successful SQL Insert
				window.location='project_edit.php?ProjectID='+parseInt(result[0]); //Goto Project Update
			}
		}

		if(document.getElementById('action').value != 'delete_quicklinks' && 
		document.getElementById('action').value != 'add_quicklinks' && 
		document.getElementById('action').value != 'gencode' && 
		document.getElementById('action').value != 'template')
			document.getElementById(document.getElementById('messageID').value).innerHTML = result[1];
			
		document.getElementById('title').innerHTML = oriMessage;

		if(document.getElementById('action').value == 'gethelp') {
			document.getElementById(document.getElementById('messageID').value).innerHTML = result[0];
			document.getElementById('helptitle').innerHTML = "Context Help";
			document.getElementById('helpdata').innerHTML = result[1];
			if(!document.getElementById('nohelp'))
				document.getElementById('helpdetected').value = 1;			
		}
		if(document.getElementById('action').value == 'startpage') {
			document.getElementById(document.getElementById('messageID').value).innerHTML = result[0];
			document.getElementById('DefaultPage').innerHTML = result[1];
		}

		//CLEAR THE RELEVANT TEXTBOXES AFTER AJAX
		document.getElementById('action').value = '';
		document.getElementById('reset2default').value = '';
		populateFields(document.getElementById('source'),document.getElementById('target'));
		enableButtons(document.forms[0]);
	}
	formParams = '';
}

function ajaxMain(formName,action){
	if(action == 'generate_project') {
		if(!document.getElementById('name').value ||
			!document.getElementById('code').value ||
			!document.getElementById('start_date').value ||
			!document.getElementById('end_date').value) {
				alert("Enter Value In Required Fields (In Red)");
				return false;
		}
		if(!checkStartEndDate('start_date','end_date'))
			return false;
	}	
	document.getElementById('action').value = action;
	getFormFields(formName);
	if(formParams == '') {
		for (i=0; i<formName.elements.length; i++) {
			if(formName.elements[i].id) {
				if(formName.elements[i].type == 'checkbox' || formName.elements[i].type == 'radio') {
					 if(formName.elements[i].checked) {
						formParams = formParams + "&" + formName.elements[i].id + "=" + encodeURIComponent(formName.elements[i].value);
					}	
				}
				else {
					formParams = formParams + "&" + formName.elements[i].id + "=" + encodeURIComponent(formName.elements[i].value);
				}	
			}	
			else if(formName.elements[i].name) {
				if(formName.elements[i].type == 'checkbox' || formName.elements[i].type == 'radio') {
					 if(formName.elements[i].checked) {
						formParams = formParams + "&" + formName.elements[i].name + "=" + encodeURIComponent(formName.elements[i].value);
					}	
				}
				else {	
					formParams = formParams + "&" + formName.elements[i].name + "=" + encodeURIComponent(formName.elements[i].value);
				}	
			}	
		}
	}

	request.open('POST', '{AJAX_FORM_POST}', true); //THIS ONE FOR POST
	request.onreadystatechange = ajaxParser;
	request.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded'); //THIS ONE ADDED FOR POST ONLY
	request.send(formParams); //THIS ONE FOR POST
}
// AJAX CORNER
</script>

</head>
<body onload="showTab();">
<table width="100%" cellpadding="0" cellspacing="2">
	<tr>
		<td><img src="{SKINROOT}/images/logo.gif" /></td>
		<td height="100%" valign="bottom">
			<table align="right" height="100%" cellspacing="5" cellpadding="0">
			<tr>
				<td class="td_top">Logged In: {FULL_NAME} |</td>
				<td class="td_top">{ADMIN_USER_LINK}</td>
				<td class="td_top">{LOGOUT_LINK}</td>
			</tr></table>
		</td>
	</tr>
	<tr><td class="spacer" colspan="2"></td></tr>
</table>

<div class="div_top_menu">
	{DIV_TOP_MENU}
</div>
	
<div class="div_top_menu_foot"></div>
<div id='submenu' class="div_sub_menu" align="right">Clock & Date Container</div>
<script>startclock();</script>
	
<table width="100%" height="100%"><tr><td nowrap valign="top">
	<table width="100%" height="100%" cellpadding="0" cellspacing="0">
	<tr>
		<td class="menu_table_parent">
		<table class="menu_table_container">
		<tr><td>
			{SIDE_MENU}
		</td></tr>
		<tr><td>
			<div id="menuAJAX" name="menuAJAX">
				{QUICKLINKS_MENU}
			</div>
		</td></tr>
		</table>
		</td>
		<td class="main_table">
		<table width="100%" class="module_page_table">
			<tr><td>
				<H1 id='title' name='title'>{H1_TITLE}</H1>
				<div id="div_breadcrumbs" name="div_breadcrumbs">{BREADCRUMBS}</div>
				<div id="{MESSAGE_ID}" name="{MESSAGE_ID}" {MESSAGE_BOX}>{MESSAGE}</div>
			</td></tr>
			<tr><td height="10"></td></tr>
			<tr><td nowrap>
				<ul id="tablist" style="display:none">
					<li><span class="current" onmouseover="overtab('sc1',this)" onmouseout="outtab('sc1',this)" onclick="return expandcontent('sc1', this)"><img title='tabimage' src="{SKINROOT}/images/menu_icons/{MENU_ICON}" align="absmiddle" />&nbsp;Project Templates List</span></li>
					<li><span onmouseover="overtab('sc2',this)" onmouseout="outtab('sc2',this)" onclick="return expandcontent('sc2', this)"><img title='tabimage' src="{SKINROOT}/images/fieldselection.gif" align="absmiddle" />&nbsp;Field Selection</span></li>
					<li><span style="display:none" id="template_editor" name="template_editor" onmouseover="overtab('sc3',this)" onmouseout="outtab('sc3',this)" onclick="return expandcontent('sc3', this)"><img title='tabimage' src="{SKINROOT}/images/fieldselection.gif" align="absmiddle" />&nbsp;Project Template Editor</span></li>
					<li><span onmouseover="overtab('helpsection',this)" onmouseout="outtab('helpsection',this)" onclick="getHelp();return expandcontent('helpsection', this)"><img title='tabimage' src="{SKINROOT}/images/help.gif" align="absmiddle" />&nbsp;Help</span></li>
				</ul>
	
				<DIV id="tabcontentcontainer">
					<form name='listing' id='listing' {FORM_ACTION} method="post" onsubmit="submitonce(this)">
					<input name="from" id="from" type="hidden" value="{POST_FROM}" />
					<input name="order" id="order" type="hidden" value="{POST_ORDER}" />
					<input name="field" id="field" type="hidden" value="{POST_FIELD}" />
					<input name="sortType" id="sortType" type="hidden" value="{POST_SORTTYPE}" />
					<input name="action" id="action" type="hidden" />
					<input name="messageID" id="messageID" value="{MESSAGE_ID}" type="hidden" />
					<input name="status_query" id="status_query" value="{STATUS_QUERY}" type="hidden" />
					<input name="selectionList" id="selectionList" type="hidden" />
					<input name="quickLinksName" id="quickLinksName" type="hidden" value="{QUICKLINKS_NAME}"/>
					<input name="quickLinksURL" id="quickLinksURL" type="hidden" value="{QUICKLINKS_URL}"/>
					<input name="quickLinksDesc" id="quickLinksDesc" type="hidden" value="{QUICKLINKS_DESC}"/>
					<input name="projectID" id="projectID" type="hidden"/>
					<input name="helpdetected" id="helpdetected" type="hidden"/>
					<input name="startup_page" id="startup_page" type="hidden" value="{STARTUP_PAGE}"/>
					<div id="sc1" class="tabcontent">
					<fieldset><legend><img src="{SKINROOT}/images/menu_icons/{MENU_ICON}" align="absmiddle" />&nbsp;Project Templates List</legend>
						<div id="listingOutputAJAX">
							{LISTING_OUTPUT}
						</div>
						<div id="listingOutputPagesAJAX">{SHOW_PAGES}</div>
						<div id="listingButtonsAJAX">{SHOW_BUTTONS}</div>
						<BR>
						<div id='search_records'><input onclick="searchContent(this)" id="search_status" name="search_status" type="checkbox" value="1" />Search Records</div>
					</fieldset>
						<BR />					
					<div id="search_content" style="display:none">
					<hr>
					<fieldset><legend><img src="{SKINROOT}/images/fieldselection.gif" align="absmiddle" />&nbsp;Search Parameter Configuration</legend>
						<div id='searchListing'>
						<input type="hidden" id='totalFields' name='totalFields' value=1 />
						<input type="hidden" id='queryGen' name='queryGen' />
						<input type="hidden" id='searchModifier' name='searchModifier' value='AND'/>
						<table id='tableSearch' class="no-border" cellpadding="1" cellspacing="3">
							<tr id="searchMain_1">
								<td><img onclick="deleteField(this.id)" id="deleteImg_1" name="deleteImg_1" style="display:none" src='{SKINROOT}/images/delete.gif' /></td>
								<td>
									<SELECT class='textbox' style="display:none" id='connector_1' name="connector_1" disabled>
										<OPTION value='OR' selected>OR</OPTION> 
										<OPTION value='AND'>AND</OPTION> 
									</SELECT> 		
								</td>
								<td>
									<SELECT class='textbox' id='selectKey_1' name="selectKey_1" onchange='jsQuery(this)'>
										<OPTION title='string' value='Name' selected>Project Name</OPTION> 
										<OPTION title='string' value='Code'>Project Code</OPTION>
										<OPTION title='date' value='StartDate'>Project StartDate</OPTION>
										<OPTION title='date' value='EndDate'>Project EndDate</OPTION>
									</SELECT> 
								</td>	
								<td>
									<SELECT class='textbox' id='selectKeyQueryOption_1' name="selectKeyQueryOption_1">
									</SELECT> 
								</td>	
								<td>
									<input class='textbox' type="text" id='selectKeyQueryText_1' name='selectKeyQueryText_1' onkeypress="return onkeypressTrap(this);" />
								</td>	
								<td><img id="calendarField_1" name="calendarField_1" style="display:none" src='{SKINROOT}/images/calendar.gif' /></td>
							</tr>
						</table>
						</div>
						<BR>
						<span>						
							<input class="buttons" onmouseover="this.className='buttons_over'" onmouseout="this.className='buttons'" type="button" value="Add New Search Field" onclick='createField(document.getElementById("searchMain_1"))' />
							<input class="buttons" onmouseover="this.className='buttons_over'" onmouseout="this.className='buttons'" type="button" value="Search" onclick='queryAJAX(document.getElementById("tableSearch"))' />				
						</span>
						<p>
							<div id="searchResultAJAX" name="searchResultAJAX">
							</div>
						</p>
						</fieldset>
					</div>
					</div>
					<div id="sc2" class="tabcontent">
					<fieldset><legend><img src="{SKINROOT}/images/fieldselection.gif" align="absmiddle" />&nbsp;Field Selection Configuration</legend>
					<div id='showFieldSelection'>
					<table width="10" border="0" cellspacing="0" cellpadding="3">
						<th colspan="4" class="fieldselect">Select Fields</th>
					  <tr class="td">
						<td align="right" nowrap>
							<table class="no-border" cellpadding="4">
							<tr><td align="right" nowrap><a href=#><img title='Move Selection One Step Up' border=0 src="{SKINROOT}/images/up_scroll2.gif" onclick="toup('target');" /></a></td></tr>
							<tr><td align="right" nowrap><a href=#><img title='Move Selection One Step Down' border=0 src="{SKINROOT}/images/down_scroll2.gif" onclick="todown('target');" /></a></td></tr>
							<tr><td align="right" nowrap><a href=#><img title='Move Selection All The Way Up' border=0 src="{SKINROOT}/images/top_scroll.gif" onclick="totop('target');" /></a></td></tr>
							<tr><td align="right" nowrap><a href=#><img title='Move Selection All The Way Down' border=0 src="{SKINROOT}/images/bottom_scroll.gif" onclick="tobottom('target');" /></a></td></tr>
							</table>
						</td>
						<td nowrap class="bold">
							Selected <BR />
							<div id='selectSelected'>
								<select class="textbox" name="target[]" size="10" WIDTH=100 multiple="multiple" id="target">
								{SELECTED_OPTIONS}
								</select>
							</div>
						</td>
						<td nowrap>
							<table class="no-border" cellpadding="4">
							<tr><td align="right" nowrap><a href=#><img title='Move Selection To The Left' border=0 src="{SKINROOT}/images/left_move.gif" onclick="javascript:copyToList('source','target');" /></a></td></tr>
							<tr><td align="right" nowrap><a href=#><img title='Move Selection To The Right' border=0 src="{SKINROOT}/images/right_move.gif" onclick="javascript:copyToList('target','source');" /></a></td></tr>
							</table>
						</td>
						<td nowrap class="bold">
							Available<BR />
							<div id='selectAvailable'>
								<SELECT class="textbox" NAME="source[]" SIZE="10" multiple="multiple" WIDTH=100 id="source" >
								{AVAILABLE_OPTIONS}
								</SELECT>
							</div>
						</td>
					  </tr>
					</table>
					<BR />
					<input name="reset2default" id="reset2default" type="hidden" />
					<input name="targetValue" id="targetValue" type="hidden" />
					<input name="sourceValue" id="sourceValue" type="hidden" />
					<input name="thisIsAJAX" id="thisIsAJAX" type="hidden" value="1"/>
					</div>	
					</fieldset>
					<span>
					<input onclick="submitSelection(source,target);" class="buttons" onmouseover="this.className='buttons_over'" onmouseout="this.className='buttons'" name="update_fields" id="update_fields" type="button" value="Update Selection" />
					<input onclick="document.getElementById('reset2default').value=1;ajaxMain(document.forms[0],'reset2default');" class="buttons" onmouseover="this.className='buttons_over'" onmouseout="this.className='buttons'" name="resetselection" id="resetselection" type="button" value="Reset Selection" />
					</span>
					</div>
					<div id="sc3" class="tabcontent">
						<fieldset><legend><img src="{SKINROOT}/images/fieldselection.gif" align="absmiddle" />&nbsp;Project Template Configuration</legend>
							<div id="listingNoOutput">No Template Currently Selected</div>
							<div id="listingMessageOutputAJAX" style="display:none">
								<div>
									<table nowrap cellspacing="0" cellpadding="3">
										<tr > 
											<th colspan="4">Project Template</th>
										</tr>
										<tr > 
											<td id="field_required">Project Name:</td>
											<td id="Project Name"><input class="textbox" type="text" id="name" name="name" size="30" maxlength="200" onkeypress="return keyPress(event,'normaltext')"></td>
											<td id="field_required">Project Code:</td>
											<td id="Project Code"><input class="textbox" type="text" id="code" name="code" size="20" maxlength="20" onkeypress="return keyPress(event,'normaltext')"> <a href="#"><img onclick="ajaxMain(document.forms[0],'gencode')" border="0" align="absmiddle" src="{SKINROOT}/images/codegen.gif"></a></td>
										</tr>
										<tr>		
										  <td id="field_required">Start Date:</td>
										  <td id="Project Start Date"><input class="textbox" id="start_date" name="start_date" type="text" size="12" maxlength="12" readonly> <img align="absmiddle" id="start_date_icon" src="{SKINROOT}/images/calendar.gif"></td>
										  <td id="field_required">End Date:</td>
										  <td id="Project End Date"><input class="textbox" id="end_date" name="end_date" type="text" size="12" maxlength="12" readonly> <img align="absmiddle" id="end_date_icon" src="{SKINROOT}/images/calendar.gif"></td>
										</tr>
										<tr  > 
											<td>Project Leader:</td>
											<td id="pm"></td>
											<td>Secondary PM:</td>
											<td id="secondary_pm"></td>
										</tr>
										<tr  > 
											<td>Client Name:</td>
											<td colspan=3 id="client"></td>
										</tr>
										<tr  > 
											<td id='field_textarea'>Description:</td>
											<td colspan=3><textarea class="textbox" id="description" name="description" cols="65" rows="5" onkeypress="return keyPress(event,'textarea')"></textarea></td>
										</tr>
										<tr  > 
											<td>Phase:</td>
											<td id='project_phase'></td>
											<td>Project Status:</td>
											<td id='project_status'>
											</td>
										</tr>
										<tr  >
											<td>Project Rate:</td>
											<td id='project_rate'></td>
											<td style="display:none">PM Approval:</td>
											<td style="display:none" id='project_leader_approve'></td>
										</tr>
										<tr  >
											<td>Estimated Hours:</td>
											<td><input value="0.00" class="textbox" maxlength="10" size="10" type="text" id="estimated_hour" name="estimated_hour" onkeypress="return keyPress(event,'number');"></td>
											<td>Estimated Cost:</td>
											<td id="project_cost">
											</td>
										</tr>
									</table>
									<table class="no-border"><tr><td nowrap>
									<BR>
									<input onclick="ajaxMain(document.forms[0],'generate_project');" class="buttons" onmouseover="this.className='buttons_over'" onmouseout="this.className='buttons'" id="generate_project" name="generate_project" type="button" value="Generate Project">
									</td></tr></table>
								</div>
							</div>
						</fieldset>
						<span>
						</span>
					</div>
					<div id="helpsection" class="tabcontent">
						<fieldset><legend><img src="{SKINROOT}/images/help.gif" align="absmiddle" /><span id='helptitle'>No Context Help Data In Session</span></legend>											
						<div id="helpdata">
							<BR />
							<input onclick='getHelp()' id="submitButton" name="submitButton" type="button" class="buttons" onmouseover="this.className='buttons_over'" onmouseout="this.className='buttons'" value="Refresh Context Help">
						</div>
						</fieldset>	
					</div>
					</form>
				</DIV>		
			</td></tr>
		</table>
		{SHOW_FOOTER}
		</td> 
	</tr>
	</table>
</td></tr></table>
	
<script>var oriMessage = document.getElementById('title').innerHTML;</script>
<script>createOptions(document.getElementById('selectKey_1'),'selectKeyQueryOption_1');</script>
<script>populateFields(document.getElementById('source'),document.getElementById('target'));</script>
<script type="text/javascript">
	Calendar.setup(
		{
			inputField 	: 	"start_date",
			ifFormat	:	"{DATE_FORMAT}",
			button		:	"start_date_icon"	
		}
	);
	Calendar.setup(
		{
			inputField 	: 	"end_date",
			ifFormat	:	"{DATE_FORMAT}",
			button		:	"end_date_icon"	
		}
	);
</script>

</body>
</html>
