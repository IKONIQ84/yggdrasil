<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>{PAGE_TITLE}</title>
{__CSS_GLOBAL__}
<style type="text/css">@import url('{SKINROOT}/javascript/{BROWSER}/calendar/calendar-blue.css');</style>
<script type="text/javascript" src="{SKINROOT}/javascript/{BROWSER}/calendar/calendar.js"></script>
<script type="text/javascript" src="{SKINROOT}/javascript/{BROWSER}/calendar/calendar-en.js"></script>
<script type="text/javascript" src="{SKINROOT}/javascript/{BROWSER}/calendar/calendar-setup.js"></script>

<script type="text/javascript" src="{SKINROOT}/javascript/{BROWSER}/helpScript.js"></script>
<script type="text/javascript" src="{SKINROOT}/javascript/{BROWSER}/tabScript.js"></script>
<script type="text/javascript" src="{SKINROOT}/javascript/{BROWSER}/functions.js"></script>
<script type="text/javascript" src="{SKINROOT}/javascript/{BROWSER}/ajaxScript.js"></script>

<script>
// AJAX CORNER

function ajaxParser(){
	if(request.readyState == 1){
		document.getElementById('title').innerHTML = oriMessage + '&nbsp;&nbsp;&nbsp;<font id="executing"><img align="top" src="{SKINROOT}/images/executing.gif">Executing...</font>';
	}
	if(request.readyState == 4){ 
		var result = request.responseText.split('regexAJAX');
		document.getElementById('title').innerHTML = oriMessage;

		if(document.getElementById('action').value == 'delete_quicklinks' || document.getElementById('action').value == 'add_quicklinks') {
			document.getElementById(document.getElementById('messageID').value).innerHTML = result[0];
			document.getElementById('quicklinks_button').innerHTML = result[1];
			document.getElementById('menuAJAX').innerHTML = result[2];
		}
		if(document.getElementById('action').value == 'update') {
			document.getElementById(document.getElementById('messageID').value).innerHTML = result[0];
		}
		if(document.getElementById('action').value == 'update_rules') {
			document.getElementById(document.getElementById('messageID').value).innerHTML = result[0];
			document.getElementById('task_table').innerHTML = result[1];
			document.getElementById('timeoff_table').innerHTML = result[2];
			document.getElementById('overall_table').innerHTML = result[3];
			document.getElementById('taskCellID').value = result[4];
			document.getElementById('timeoffCellID').value = result[5];
			document.getElementById('overallCellID').value = result[6];			
		}
		if(document.getElementById('action').value == 'gethelp') {
			document.getElementById(document.getElementById('messageID').value).innerHTML = result[0];
			document.getElementById('helptitle').innerHTML = "Context Help";
			document.getElementById('helpdata').innerHTML = result[1];
			if(!document.getElementById('nohelp'))
				document.getElementById('helpdetected').value = 1;			
		}
		if(document.getElementById('action').value == 'getlog') {
			document.getElementById(document.getElementById('messageID').value).innerHTML = result[0];
			document.getElementById('logtitle').innerHTML = "Log Data";
			document.getElementById('logdata').innerHTML = result[1];
		}
		if(document.getElementById('action').value == 'startpage') {
			document.getElementById(document.getElementById('messageID').value).innerHTML = result[0];
			document.getElementById('DefaultPage').innerHTML = result[1];
		}
		//CLEAR THE RELEVANT TEXTBOXES AFTER AJAX
		document.getElementById('action').value = '';
		enableButtons(document.forms[0]);
	}
	formParams = '';
}

function ajaxMain(formName,action){
	document.getElementById('action').value = action;
	getFormFields(formName);
	if(formParams == '') {
		for (i=0; i<formName.elements.length; i++) {
			if(formName.elements[i].id) {
				if(formName.elements[i].type == 'checkbox' || formName.elements[i].type == 'radio') {
					 if(formName.elements[i].checked) {
						formParams = formParams + "&" + formName.elements[i].id + "=" + encodeURIComponent(formName.elements[i].value);
					}	
				}
				else {
					formParams = formParams + "&" + formName.elements[i].id + "=" + encodeURIComponent(formName.elements[i].value);
				}	
			}	
			else if(formName.elements[i].name) {
				if(formName.elements[i].type == 'checkbox' || formName.elements[i].type == 'radio') {
					 if(formName.elements[i].checked) {
						formParams = formParams + "&" + formName.elements[i].name + "=" + encodeURIComponent(formName.elements[i].value);
					}	
				}
				else {	
					formParams = formParams + "&" + formName.elements[i].name + "=" + encodeURIComponent(formName.elements[i].value);
				}	
			}	
		}
	}

	request.open('POST', '{AJAX_FORM_POST}', true); //THIS ONE FOR POST
	request.onreadystatechange = ajaxParser;
	request.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded'); //THIS ONE ADDED FOR POST ONLY
	request.send(formParams); //THIS ONE FOR POST
}

// AJAX CORNER
</script>
<script>
function createField(nodeObj,type) {
	if(type == 'Task') {
		var CellID = 'taskCellID';
		var CellName = 'Task';
	}	
	else if(type == 'Timeoff') {
		var CellID = 'timeoffCellID';
		var CellName = 'Timeoff';
	}	
	else if(type == 'Overall') {
		var CellID = 'overallCellID';
		var CellName = 'Overall';
	}	

	var arrCellID = document.getElementById(CellID).value.split(',');
	var idCount;
	var duplicate;

	//GET UNIQUE ID COUNT
	for (var i=1; i>=1; i++) {
		duplicate = false;
		for (var j=0; j<arrCellID.length-1; j++) {
			if(arrCellID[j] == i) {
				duplicate = true;
				break;
			}	
		}
		if(!duplicate) {
			idCount = i;
			break;
		}				
	}
	
	//ADD CLONED NODE ID 
	document.getElementById(CellID).value = document.getElementById(CellID).value + idCount + ",";
	var clonedNode = nodeObj.cloneNode(true);
	clonedNode.setAttribute('id',CellName+'row_'+idCount);
	nodeObj.parentNode.appendChild(clonedNode);
	changeID(clonedNode,idCount);

	document.getElementById(CellName+'row_'+idCount).style.display = '';
}

function changeID(obj,idCount) {
	if(obj.id)
		var objID = obj.id;
	else
		var objID = 'none';
			
	if(objID.match("_x")) {
		objID = objID.replace("_x","_"+idCount);
		obj.setAttribute('id',objID);
		obj.setAttribute('name',objID);
	}

	if(obj.hasChildNodes()) {
		for(var i=0; i < obj.childNodes.length; i++) {
			changeID(obj.childNodes[i],idCount);
		}
	}
}
function deleteField(imgID,type) {
	if(confirm('Are You Sure?')) {
		if(type == 'Task') {
			var CellID = 'taskCellID';
			var CellName = 'Task';
		}	
		else if(type == 'Timeoff') {
			var CellID = 'timeoffCellID';
			var CellName = 'Timeoff';
		}	
		else if(type == 'Overall') {
			var CellID = 'overallCellID';
			var CellName = 'Overall';
		}
		var fieldIDArr = imgID.split('_');
		var fieldID = type+'row_'+fieldIDArr[1];
		var fieldObj = document.getElementById(fieldID);
		fieldObj.parentNode.removeChild(fieldObj);

		var arrCellID = document.getElementById(CellID).value.split(',');
		var newCellID = '';
		
		for (var i=0; i<arrCellID.length-1; i++) {
			if(arrCellID[i] != fieldIDArr[1]) {
				newCellID = newCellID + arrCellID[i] + ',';
			}
		}
		document.getElementById(CellID).value = newCellID;
	}
}
</script>
</head>

<body onload="showTab();">
<table width="100%" cellpadding="0" cellspacing="2">
	<tr>
		<td><img src="{SKINROOT}/images/logo.gif" /></td>
		<td height="100%" valign="bottom">
			<table align="right" height="100%" cellspacing="5" cellpadding="0">
			<tr>
				<td class="td_top">Logged In: {FULL_NAME} |</td>
				<td class="td_top">{ADMIN_USER_LINK}</td>
				<td class="td_top">{LOGOUT_LINK}</td>
			</tr></table>
		</td>
	</tr>
	<tr><td class="spacer" colspan="2"></td></tr>
</table>
	
<div class="div_top_menu">
	{DIV_TOP_MENU}
</div>
	
<div class="div_top_menu_foot"></div>
<div id='submenu' class="div_sub_menu" align="right">Clock & Date Container</div>
<script>startclock();</script>

<table width="100%" height="100%"><tr><td nowrap valign="top">
	<table width="100%" height="100%" cellpadding="0" cellspacing="0">
	<tr>
		<td class="menu_table_parent">
		<table class="menu_table_container">
		<tr><td>
			{SIDE_MENU}
		</td></tr>
		<tr><td>
			<div id="menuAJAX" name="menuAJAX">
				{QUICKLINKS_MENU}
			</div>
		</td></tr>
		</table>
		</td>
		<td class="main_table">
		<table width="100%" class="module_page_table">
			<tr><td>
				<H1 id='title' name='title'>{H1_TITLE}</H1>
				<div id="div_breadcrumbs" name="div_breadcrumbs">{BREADCRUMBS}</div>
				<div id="{MESSAGE_ID}" name="{MESSAGE_ID}" {MESSAGE_BOX}>{MESSAGE}</div>
			</td></tr>
			<tr><td height="10"></td></tr>
			<tr><td nowrap>
				<ul id="tablist" style="display:none">
					<li><span class="current" onmouseover="overtab('sc1',this)" onmouseout="outtab('sc1',this)" onclick="return expandcontent('sc1', this)"><img title='tabimage' src="{SKINROOT}/images/menu_icons/{MENU_ICON}" align="absmiddle" />&nbsp;Timesheet Settings Configuration</span></li>
					<li><span onmouseover="overtab('sc2',this)" onmouseout="outtab('sc2',this)" onclick="return expandcontent('sc2', this)"><img title='tabimage' src="{SKINROOT}/images/approve.gif" align="absmiddle" />&nbsp;Timesheet Approval Rules</span></li>
					<li><span onmouseover="overtab('logsection',this)" onmouseout="outtab('logsection',this)" onclick="getLog();return expandcontent('logsection', this)"><img title='tabimage' src="{SKINROOT}/images/log.gif" align="absmiddle" />&nbsp;Log</span></li>
					<li><span onmouseover="overtab('helpsection',this)" onmouseout="outtab('helpsection',this)" onclick="getHelp();return expandcontent('helpsection', this)"><img title='tabimage' src="{SKINROOT}/images/help.gif" align="absmiddle" />&nbsp;Help</span></li>
				</ul>
	
				<DIV id="tabcontentcontainer">
					<form name='addupdate' id='addupdate' {FORM_ACTION} method="post" onsubmit="submitonce(this)">
					<input name="addupdateID" id="addupdateID" type="hidden" value="{ID}" />
					<input name="update_title" id="update_title" type="hidden" value="{H1_TITLE}" />
					<input name="action" id="action" type="hidden" />
					<input name="submit_action" id="submit_action" type="hidden" value="{SUBMIT_ACTION}" />
					<input name="messageID" id="messageID" value="{MESSAGE_ID}" type="hidden" />
					<input name="quickLinksName" id="quickLinksName" type="hidden" value="{QUICKLINKS_NAME}"/>
					<input name="quickLinksURL" id="quickLinksURL" type="hidden" value="{QUICKLINKS_URL}"/>
					<input name="quickLinksDesc" id="quickLinksDesc" type="hidden" value="{QUICKLINKS_DESC}"/>
					<input name="taskCellID" id="taskCellID" type="hidden" value="{TASK_CELL_ID}"/>
					<input name="timeoffCellID" id="timeoffCellID" type="hidden" value="{TIMEOFF_CELL_ID}"/>
					<input name="overallCellID" id="overallCellID" type="hidden" value="{OVERALL_CELL_ID}"/>
					<input name="helpdetected" id="helpdetected" type="hidden"/>
					<input name="LogType" id="LogType" type="hidden" value="{LOGTYPE}"/>
					<input name="LogAction" id="LogAction" type="hidden" value="{LOGACTION}"/>
					<input name="startup_page" id="startup_page" type="hidden" value="{STARTUP_PAGE}"/>
					<div id="sc1" class="tabcontent">
						<fieldset><legend><img src="{SKINROOT}/images/menu_icons/{MENU_ICON}" align="absmiddle" />&nbsp;<span id='subtitle'>{H1_TITLE}</span></legend>
							<div id="listingOutputAJAX">
							<table nowrap cellspacing="0" cellpadding="3">
								<th align="left">Settings</th><th align="left">Value</th>
								<tr>
									<td>Timesheet Activation Date:</td>
									<td><input value="{EFFECTIVE_DATE}" class="textbox" id="activate_date" name="activate_date" type="text" size="12" maxlength="11" readonly="true">&nbsp;<img id="activate_date_icon" align="absmiddle" src="{SKINROOT}/images/calendar.gif"></td>
								</tr>
								<tr>
									  <td>Timesheet Due Day:</td>
									  <td nowrap>
										<SELECT id="submit_overdue" name="submit_overdue" class="textbox">
											{SELECT_OVERDUE}
											{OVERDUE_SELECTED}
										</SELECT> for email notification purposes
									</td>
								</tr>
								<tr>
									  <td>Timesheet Due Email Sent Based On:</td>
									  <td nowrap>
										<input id="due_week" name="due_week" type="radio" value="1" {DUE_SAME_WEEK}>Current Week <input id="due_week" name="due_week" type="radio" value="0" {DUE_PREV_WEEK}>Previous Week
									</td>
								</tr>
								<tr>
									  <td>Timesheet OverDue Day:</td>
									  <td nowrap>
										<SELECT id="submit_overdueday" name="submit_overdueday" class="textbox">
											<option value='0' {OD_SUN}>Sunday</option>
											<option value='1' {OD_MON}>Monday</option>
											<option value='2' {OD_TUE}>Tuesday</option>
											<option value='3' {OD_WED}>Wednesday</option>
											<option value='4' {OD_THU}>Thursday</option>
											<option value='5' {OD_FRI}>Friday</option>
											<option value='6' {OD_SAT}>Saturday</option>
										</SELECT> for email notification purposes
									</td>
								</tr>
								<tr>
									  <td>Timesheet Overdue Email Sent Based On:</td>
									  <td nowrap>
										<input id="overdue_week" name="overdue_week" type="radio" value="1" {OVERDUE_SAME_WEEK}>Current Week <input id="overdue_week" name="overdue_week" type="radio" value="0" {OVERDUE_PREV_WEEK}>Previous Week
									</td>
								</tr>
								<tr style="display:none">
									<td nowrap>Auto Disable Entry For Closed Projects / Tasks?:</td>
									<td><input id="disablets" name="disablets" type="radio" value="1" {DISABLE_TS}>YES <input id="disablets" name="disablets" type="radio" value="0" {ENABLE_TS}>NO</td>
								</tr>
								<tr {SHOW_FIRSTDAY}>
									<td nowrap>Timesheet Week:</td>
									<td>
									<SELECT class="textbox" id="startweek" name="startweek">
										<option value='0' {WEEK_SUN}>Sunday to Saturday</option>
										<option value='1' {WEEK_MON}>Monday to Sunday</option>
										<option value='2' {WEEK_TUE}>Tuesday to Monday</option>
										<option value='3' {WEEK_WED}>Wednesday to Tuesday</option>
										<option value='4' {WEEK_THU}>Thursday to Friday</option>
										<option value='5' {WEEK_FRI}>Friday to Saturday</option>
										<option value='6' {WEEK_SAT}>Saturday to Sunday</option>
									</SELECT>
									</td>
								</tr>
								<tr>
									<td>Default Weekend / Off Days:</td>
									<td nowrap>
									<input id="sun" name="sun" type="checkbox" value="0:" {SUN_CHECK}>Sun
									<input id="mon" name="mon" type="checkbox" value="1:" {MON_CHECK}>Mon
									<input id="tue" name="tue" type="checkbox" value="2:" {TUE_CHECK}>Tue
									<input id="wed" name="wed" type="checkbox" value="3:" {WED_CHECK}>Wed
									<input id="thu" name="thu" type="checkbox" value="4:" {THU_CHECK}>Thu
									<input id="fri" name="fri" type="checkbox" value="5:" {FRI_CHECK}>Fri
									<input id="sat" name="sat" type="checkbox" value="6:" {SAT_CHECK}>Sat
									</td>
								</tr>
								<tr>
									<td>Working Hours:</td>
									<td class="bold">Time-In: <SELECT class="textbox" id="hour_start" name="hour_start">{DEFAULT_HOUR_START}</SELECT> <SELECT class="textbox" id="minute_start" name="minute_start">{DEFAULT_MINUTE_START}</SELECT>
									 Time-Out:  <SELECT class="textbox" id="hour_end" name="hour_end">{DEFAULT_HOUR_END}</SELECT> <SELECT class="textbox" id="minute_end" name="minute_end">{DEFAULT_MINUTE_END}</SELECT></td>
								</tr>
								<tr>
									<td id="field_required">Minimum Weekly Hours:</td>
									<td id='Minimum Weekly Hours'><input title='required' value="{MINIMUM_WEEK}" onKeypress="return keyPress(event,'number');" class="textbox" id="minimum_week" name="minimum_week" type="text" size="7" maxlength="7"></td>
								</tr>
								<tr>
									<td id="field_required">Minimum Daily Hours:</td>
									<td id='Minimum Daily Hours'><input title='required' value="{MINIMUM_DAY}" onKeypress="return keyPress(event,'number');" class="textbox" id="minimum_day" name="minimum_day" type="text" size="7" maxlength="7"></td>
								</tr>
								<tr>
									<td>Enable Undo for Approved Timesheet?:</td>
									<td><input id="enable_undo" name="enable_undo" type="radio" value="1" {ENABLE_UNDO}>Enable Undo <input id="enable_undo" name="enable_undo" type="radio" value="0" {DISABLE_UNDO}>Disable Undo</td>
								</tr>
							</table>	
							</div>
							<div id="listingButtonsAJAX">{SHOW_BUTTONS}</div>
						</fieldset>
					</div>
					<div id="sc2" class="tabcontent">
						<fieldset><legend><img src="{SKINROOT}/images/approve.gif" align="absmiddle" />&nbsp;<span id='subtitle'>Timesheet Approval Rules Configuration</span></legend>
							<p>
							<legend><span id='subtitle'>Task Approval</span></legend>
								<div id="task_table">
									{TASK_APPROVAL}
								</div>
							</p>	
							<p>
							<legend><span id='subtitle'>Timeoff Approval</span></legend>
								<div id="timeoff_table">
									{TIMEOFF_APPROVAL}
								</div>
							</p>	
							<p>
							<legend><span id='subtitle'>Overall Approval</span></legend>
								<div id="overall_table">
									{OVERALL_APPROVAL}
								</div>
							</p>	
							<div><input id="propagate" name="propagate" type="checkbox" value="1" />Propagate To All Users? (This Will Overwrite Previous User Specific Settings)</div>
							<div id="listingButtonsAJAX"><input onclick="ajaxMain(document.forms[0],'update_rules')" id="update_rules" name="update_rules" value="Update Rules" class="buttons" onmouseover="this.className='buttons_over'" onmouseout="this.className='buttons'" type="button" {DEMO_BUTTON_HIDE}></div>
						</fieldset>
					</div>
					<div id="logsection" class="tabcontent">
						<fieldset><legend><img src="{SKINROOT}/images/log.gif" align="absmiddle" /><span id='logtitle'>No Log Data In Session</span></legend>											
						<div id="logdata">
							<BR />
							<input onclick='getLog()' id="submitButton" name="submitButton" type="button" class="buttons" onmouseover="this.className='buttons_over'" onmouseout="this.className='buttons'" value="Refresh Log Data">
						</div>
						</fieldset>	
					</div>
					<div id="helpsection" class="tabcontent">
						<fieldset><legend><img src="{SKINROOT}/images/help.gif" align="absmiddle" /><span id='helptitle'>No Context Help Data In Session</span></legend>											
						<div id="helpdata">
							<BR />
							<input onclick='getHelp()' id="submitButton" name="submitButton" type="button" class="buttons" onmouseover="this.className='buttons_over'" onmouseout="this.className='buttons'" value="Refresh Context Help">
						</div>
						</fieldset>	
					</div>
					</form>
				</DIV>		
			</td></tr>
		</table>
		{SHOW_FOOTER}
		</td> 
	</tr>
	</table>
</td></tr></table>	
<script type="text/javascript">
	Calendar.setup(
		{
			inputField 	: 	"activate_date",
			ifFormat	:	"{DATE_FORMAT}",
			button		:	"activate_date_icon"	
		}
	);
</script>

<script>var oriMessage = document.getElementById('title').innerHTML;</script>
</body>
</html>
